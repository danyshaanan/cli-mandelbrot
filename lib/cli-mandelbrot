#!/usr/bin/env node

"use strict";

var cli = require('commander');
var clc = require('cli-color');
var rek = require('rekuire');

var version = rek('package.json').version;
var def = rek('def');
var input = rek('input');
var getScreen = rek('cache').getScreen;

var helpTextOn = true;

cli
  .version(version)
  .usage("")
  .option("-j, --julia", "start in julia mode")
  .parse(process.argv);


function next() {
  var text = [
    JSON.stringify(def,null,2),
    "q: toggle help text",
    "w: up",
    "s: down",
    "a: left",
    "d: right",
    "r: zoom in",
    "f: zoom out",
    "t: more iterations",
    "g: less iterations",
    "j: toggle julia mode",
    "e: when in julia mode, toggle to julia movement",
    "o: quit",
    ""
    ].join("\n");
  var output = clc.moveTo(0,0) + getScreen(def, clc.width-1, clc.height);
  if (helpTextOn) {
    output += clc.moveTo(0,0) + clc.xterm(8)(text);
  }
  process.stdout.write(output);
}

def.julia.on = Boolean(cli.julia);

process.stdin.setRawMode(true);
process.stdin.resume();
process.stdin.on("data", function(data) {
  var key = data.toString()[0];
  if (key == "o") {
    process.exit();
  } else if (key == "q") {
    helpTextOn = !helpTextOn;
  }
  def = input.keyPress(def, key);
  next();
});

next();
